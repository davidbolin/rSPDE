---
title: "An introduction to the rSPDE package"
author: "David Bolin, Alexandre B. Simas, Zhen Xiong"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{An introduction to the rSPDE package}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
references:
- id: bolin19
  title: "The rational SPDE approach for Gaussian random fields with general smoothness"
  author:
  - family: Bolin
    given: David
  - family: Kirchner
    given: Kristin
  container-title: Journal of Computational and Graphical Statistics
  volume: 29
  issue: 2
  page: 274-285
  type: article-journal
  issued:
    year: 2020
- id: lindgren11
  title: "An explicit link between Gaussian fields and Gaussian Markov random fields: the stochastic partial differential equation approach"
  author:
  - family: Lindgren
    given: Finn
  - family: Rue
    given: Håvard
  - family: Lindström
    given: Johan
  container-title: Journal of the Royal Statistical Society. Series B. Statistical Methodology
  volume: 73
  issue: 4
  page: 423--498
  type: article-journal
  issued:
    year: 2011
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)

set.seed(1)
```

## Introduction

In this vignette we will provide a brief introduction to the `rSPDE`
package by providing a simple data set and using the different functions in
the package to analyze it.

We have three main "families" of functions inside the `rSPDE` package:

* The `R-INLA` implementation of the rational SPDE approach;

* The covariance-based rational SPDE approach;

* The operator-based rational SPDE approach.

We will analyze the same data set using all the three approaches.
We also have specific vignettes for each of the aforementioned family. More precisely,
we have the following additional vignettes:

* [R-INLA implementation of the rational SPDE approach](rspde_inla.html)

* [Covariance-based rational approximation with the rSPDE package](rspde_cov.html)

* [Operator-based rational approximation with the rSPDE package](rspde_base.html)

We will now begin by creating a toy data set.

## A toy data set

For this illustration, we will simulate a data set on a two-dimentional spatial domain. 
To this end, we need to construct a mesh over the domain of interest and then compute 
the matrices needed to define the operator. We will use the `R-INLA` package
to create the mesh and obtain the matrices of interest.

We will begin by defining a mesh over $[0,1]\times [0, 1]$:

```{r, message=FALSE, warning=FALSE}
library(INLA)
m =100
loc_2d_mesh = matrix(runif(m*2),m,2)
mesh_2d = inla.mesh.create.helper(
  points=loc_2d_mesh,
  cutoff=0.05,
  offset=c(0.1,0.4),
  max.edge=c(0.05,0.5) )
plot(mesh_2d)
points(loc_2d_mesh[,1],loc_2d_mesh[,2])
```

There are two matrices we need to create the approximation of a basic Matérn model. 
These matrices are the mass matrix $\boldsymbol{\mathrm{C}}$, with elements 
$C_{ij} = \int \varphi_j(s) \varphi_i(s) ds$, and the stiffness matrix 
$\boldsymbol{\mathrm{G}}$, with elements 
$G_{ij} = \int \nabla\varphi_j(s) \cdot \nabla\varphi_i(s) ds$. 

Now, let us compute these matrices for this mesh using `INLA`'s `inla.fem.mesh()` function:

```{r}
fem_mesh_2d <- inla.mesh.fem(mesh_2d)
C = fem_mesh_2d$c0
G <- fem_mesh_2d$g1
```

We want to use these matrices to simulate Gaussian latent fields with
Matérn covariance. To this end, we have two functions possibilities: simulate
the latent field using the operator-based rational approximation
or using the covariance-based rational approximation. We will use both of them, and
consider the realizations as replicates. We will generate 20 independent
replicates from the operator-based rational approximation and 20 independent
replicates from the covariance-based rational approximation.

Let $\mathbf{X}_1$ be 



# References

